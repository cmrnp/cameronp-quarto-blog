<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Cameron Patrick</title>
<link>https://cameronpatrick.com/blog.html</link>
<atom:link href="https://cameronpatrick.com/blog.xml" rel="self" type="application/rss+xml"/>
<description></description>
<generator>quarto-1.3.302</generator>
<lastBuildDate>Tue, 27 Jun 2023 14:00:00 GMT</lastBuildDate>
<item>
  <title>Untangling missing data mechanisms using causal DAGs</title>
  <dc:creator>Cameron Patrick</dc:creator>
  <link>https://cameronpatrick.com/post/2023/06/untangling-mar-mcar-mnar/index.html</link>
  <description><![CDATA[ 




<p>Missing data refers to data which was intended to have been collected but was not, and is a common scenario in biomedical and social science research. Correctly analysing datasets that have missing data requires extra care and consideration to produce correct results.</p>
<p>The best method for dealing with missing data depends on the underlying process causing the missingness. There is no single approach that is always the best, and the terminology commonly used to describe missingness doesn’t directly relate to what analysis methods perform best. In this blog post I’ll begin by defining the commonly used but unhelpful classifications for missing data mechanisms (you’ll see them everywhere, so you might as well know what they mean) and then explain how to describe missing data processes using causal diagrams (DAGs) and provide some references to help choose an analysis based on that.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cameronpatrick.com/post/2023/06/untangling-mar-mcar-mnar/dont_fight_a_cat_MI.jpeg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">(original image via <a href="https://twitter.com/marginoferror/status/935937659888836609">@marginoferror on Twitter</a>, adapted by me for missing data purposes.)</figcaption><p></p>
</figure>
</div>
<section id="mcar-mar-mnar-or-nah" class="level2">
<h2 class="anchored" data-anchor-id="mcar-mar-mnar-or-nah">MCAR, MAR, MNAR or nah?</h2>
<p>The most common classification for missing data mechanisms is as either Missing Completely at Random (MCAR), Missing at Random (MAR), or Missing Not at Random (MNAR). This classification is based on concepts first introduced in <span class="citation" data-cites="rubin_inference_1976">Rubin (1976)</span>. These terms are widespread, but can be confusing when first encountered because they do not mean quite what you might expect them to mean. I’ll define them briefly here, but the goal is to not have to focus specifically about which of these mechanisms apply to your data, or use this classification to guide your analytical choices.</p>
<p>Data is considered to be <strong>Missing Completely at Random (MCAR)</strong> if the probability of being missing does not depend on the values of any of the variables in the data, whether those values are missing or observed <span class="citation" data-cites="little_statistical_2014">(Little &amp; Rubin, 2014, p. 12)</span>. In other words, the missingness cannot be related to the research question of interest <span class="citation" data-cites="lee_framework_2021">(Lee et al., 2021)</span>.</p>
<p>Data is <strong>Missing at Random (MAR)</strong> if the probability of being missing depends only on data that was observed <span class="citation" data-cites="little_statistical_2014">(Little &amp; Rubin, 2014, p. 12)</span>. Most commonly this refers to a situation where a variable with incomplete data has probability of being missing which relates to completely-observed variables, but there are other possibilities which fit this definition too<sup>1</sup>. This term is misleading if encountered without context, as a plain-language interpretation suggests it may mean something more like MCAR. However, MCAR is a stricter requirement than MAR. If data is MCAR, it is also considered MAR.</p>
<p>Data is <strong>Missing Not at Random (MNAR)</strong> if it’s not Missing at Random <span class="citation" data-cites="little_statistical_2014">(Little &amp; Rubin, 2014, p. 12)</span>. At least that’s relatively straightforward. In other words, the probability of data being missing may be related to what the missing values would have been, had we observed them. It is sometimes implied that MNAR data is a lost cause for statistical analysis, but later in this post we will see specific examples of MNAR mechanisms where common statistical procedures produce valid results for common questions.</p>
<p>Strictly speaking, these classifications refer to the entire dataset collectively, usually consisting of many variables, some of which may have missing values and some of which may not. When there are multiple variables with missing values — a common situation in real datasets — these classifications are sometimes informally applied to specific variables with missing data, but doing so doesn’t relate to any of the mathematical guarantees about which analysis methods are applicable.</p>
<p>These missing data classifications depend on the set of available variables. For example, if additional variables (sometimes called auxiliary variables) which relate to probability of partially-observed variables having missing values are added to the dataset, the missing data mechanism may change from being MNAR to being MAR.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Historical aside
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="citation" data-cites="rubin_inference_1976">Rubin (1976)</span> is often cited as the source of this classification system, but didn’t actually introduce the terms Missing Completely at Random or Missing Not at Random, only Missing at Random. Rubin originally defined an additional condition, Observed at Random. Data which is both Missing at Random and Observed at Random is what we would now commonly refer to as Missing Completely at Random. The term Missing Completely at Random came later, in <span class="citation" data-cites="marini_maximum-likelihood_1980">Marini et al. (1980)</span>. This history is given in <span class="citation" data-cites="little_missing_2021">Little (2021)</span> and was also confirmed <a href="https://twitter.com/rnishimura/status/1668824406766878721">in a Tweet by Raphael Nishimura</a>: ‘I was curious about that too and did some digging with the authors. Rod said that “Rubin’s 1976 Biometrika paper defines MAR and OAR (observed at random) but he may not have put the two together.” Don confirmed it and added that “MCAR was first formally defined in a joint paper with Marini and Olsen, I think in 1980, in a more applied paper.”’</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ignorable and non-ignorable missingness
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sometimes you may hear missing data described as “ignorable” or “non-ignorable”. These terms are also potentially misleading. “Ignorable” missing data doesn’t mean that you can just ignore the fact that you have missing data when doing an analysis. This term was defined in <span class="citation" data-cites="rubin_inference_1976">Rubin (1976)</span> to mean that (1) the data is MAR; (2) the likelihood can be factorised into a part relating to the missingness probability and a part relating to the distribution of the underlying data. These provide a sufficient condition for missing data to be dealt with using likelihood-based methods.</p>
</div>
</div>
<section id="how-do-i-know-what-kind-of-missing-data-mechanism-i-have" class="level3">
<h3 class="anchored" data-anchor-id="how-do-i-know-what-kind-of-missing-data-mechanism-i-have">How do I know what kind of missing data mechanism I have?</h3>
<p>Unfortunately, there’s no way to determine the missing data mechanism purely by looking at the data — you need to think about the process generating the data and why some of it is missing. A causal DAG is a good way to reason about the relationship between the variables and their reasons for being missing and can help you decide what analysis to use. Rather than using the DAG to determine whether your data is MCAR, MAR, or MNAR, and then use those classifications to choose an analysis, you can use the DAG directly to guide your choice of analysis method. I’ll have examples of this later in this blog.</p>
</section>
<section id="if-i-know-my-missing-data-mechanism-what-analysis-should-i-do" class="level3">
<h3 class="anchored" data-anchor-id="if-i-know-my-missing-data-mechanism-what-analysis-should-i-do">If I know my missing data mechanism, what analysis should I do?</h3>
<p>It depends! (I’m statistician, you should have known I would say that.) These are the standard results about what missing data methods are appropriate under different processes:</p>
<p>Complete cases analysis is unbiased if the data is MCAR. This is a sufficient condition, not a necessary condition <span class="citation" data-cites="little_missing_2021">(Little, 2021)</span>: there are situations where complete cases may be valid, or at least provide a valid estimate of a particular quantity of interest, under MAR or MNAR. Depending on the amount of missing data, complete cases analysis may be inefficient (i.e., have lower power than other methods) because only cases where no variables have missing values are used in the analysis.</p>
<p>Multiple imputation, likelihood-based methods and full Bayesian methods are unbiased if the data is MAR or MCAR <span class="citation" data-cites="little_missing_2021">(Little, 2021)</span>. Multiple imputation is approximately equivalent to a maximum-likelihood method if the underlying model is the same <span class="citation" data-cites="collins_comparison_2001">(Collins et al., 2001)</span>.</p>
<p>In some specific MNAR situations, either or both of the above methods may still be valid, depending on what you’re trying to estimate <span class="citation" data-cites="white_bias_2010">(White &amp; Carlin, 2010)</span>.</p>
</section>
</section>
<section id="some-examples-of-missing-data-mechanisms" class="level2">
<h2 class="anchored" data-anchor-id="some-examples-of-missing-data-mechanisms">Some examples of missing data mechanisms</h2>
<p>To make these definitions more concrete, here are some examples of missing data mechanisms that may occur in real studies.</p>
<section id="example-1-planned-missing-data" class="level3">
<h3 class="anchored" data-anchor-id="example-1-planned-missing-data">Example 1: Planned missing data</h3>
<p>Sometimes missing data arises from a study design where some data is not collected on some participants. For example, consider a psychometric instrument with a large number of items. The items could be split up into sets which are asked at different times; for example, half at baseline and half a follow-up. Ideally this process would be randomised so each participant receives a different random split. The items which were not asked at a particular time point are missing values, and because the missingness was deliberately introduced by the experimenter using randomisation, we know that the probability of a particular item being missing is unrelated to any other variable in the study.</p>
<p>This is one of the few cases where we can be sure the data is MCAR.</p>
</section>
<section id="example-2-missingness-related-to-confounders-only" class="level3">
<h3 class="anchored" data-anchor-id="example-2-missingness-related-to-confounders-only">Example 2: Missingness related to confounders only</h3>
<p>Consider a longitudinal study where participants need to regularly travel to a site, for example a hospital, in order for their data to be recorded. Participants living in rural or remote areas may find the travel more inconvenient if they need to visit a city to participate in the study, and thus be more likely to have missing values in many variables.</p>
<p>If we know the location of all of the participants, or the missingness in the participant location is unrelated to any other study variable, this missingness mechanism would be MAR.</p>
</section>
<section id="example-3-missingness-related-to-confounders-and-exposure" class="level3">
<h3 class="anchored" data-anchor-id="example-3-missingness-related-to-confounders-and-exposure">Example 3: Missingness related to confounders and exposure</h3>
<p>This example is drawn from <span class="citation" data-cites="moreno-betancur_canonical_2018">Moreno-Betancur et al. (2018)</span>. Suppose we want to investigate the relationship between childhood maternal mental illness (the exposure, in epidemiologist-speak) and child behaviour in subsequent years (the outcome). In order to provide a causal estimate of the effect of this exposure, we must control for confounding variables, such as maternal alcohol consumption, smoking, and other variables relating to the child’s health.</p>
<p>It was considered likely that missingness in all variables was related to both maternal mental illness and the counfounding variables. Since child behaviour was measured at a later time than the exposure and confounding variables, it was considered unlikely to have affected missingness in the confounders or exposure.</p>
<p>It was uncertain whether missingness in child behaviour could be related to the child behaviour itself — so there are two plausible missing data mechanisms to consider in this example. Both of those plausible mechanisms are MNAR, but we will see later than one possibility is amenable for analysis and the other is not.</p>
</section>
</section>
<section id="making-the-missing-data-process-explicit-using-causal-diagrams-dags" class="level2">
<h2 class="anchored" data-anchor-id="making-the-missing-data-process-explicit-using-causal-diagrams-dags">Making the missing data process explicit using causal diagrams (DAGs)</h2>
<p>Causal diagrams are used to represent causal relationships between variables in a study <span class="citation" data-cites="pearl_causal_1995">(Pearl, 1995)</span>. These relationships are shown visually using a directed acyclic graph (DAG), which is a mathematical term for a bunch of circles with arrows between them. The circles (nodes) represent variables and arrows (edges) between them represent direct causal pathways. The direction of the arrows represents the direction of causation, and a valid DAG never has a path leading from a particular point back to that same point<sup>2</sup>. If there is no path following the arrows between two variables in a DAG, there is no causal connection between them.</p>
<p>The structure of the DAG behind your data cannot be inferred just from looking at the data. It needs to come from substantive expertise about the underlying variables in the data, their relationship to each other, and how the data was collected.</p>
<p>The idea of using a DAG to represent missing data assumptions was first introduced in <span class="citation" data-cites="mohan_graphical_2014">Mohan &amp; Pearl (2014)</span>. To provide more practical advice for specific scenarios, <span class="citation" data-cites="moreno-betancur_canonical_2018">Moreno-Betancur et al. (2018)</span> introduces “canonical” causal diagrams for missing data in the setting where we want to estimate the relationship between an outcome <em>Y</em> and an exposure <em>X</em><sup>3</sup>, adjusting for some confounding variables which may influence both the outcome and the exposure. The confounding variables may be either completely observed (<em>Z1</em>) or have some missing data (<em>Z2</em>). There may also be some unknown, unmeasured factors <em>U</em> which affect the exposure and the confounders.</p>
<p>The DAG corresponding to the scenario above is shown below. If you click the “Code” button you can see how it was produced in R, using the packages <a href="http://www.dagitty.net/"><em>dagitty</em></a> <span class="citation" data-cites="textor_robust_2017">(Textor et al., 2017)</span> and <a href="https://CRAN.R-project.org/package=ggdag"><em>ggdag</em></a>. You don’t need to understand R code to use and apply DAGs but it is provided as an example for those who may want to make causal diagrams for their own studies. The first part of the code describes the underlying relationships between the variables, using the same syntax used to describe regression models in R. The second part of the code sets up the visual coordinates used for plotting the DAG — an aesthetic consideration only.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">dag_nomiss <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dagify</span>(</span>
<span id="cb1-2">  Y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z2,</span>
<span id="cb1-3">  X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> U,</span>
<span id="cb1-4">  Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> U,</span>
<span id="cb1-5">  Z2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> U,</span>
<span id="cb1-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coords =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">U =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z1 =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z2 =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>),</span>
<span id="cb1-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">U =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z1 =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z2 =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb1-9">  )</span>
<span id="cb1-10">)</span>
<span id="cb1-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggdag</span>(dag_nomiss) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_dag</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2023/06/untangling-mar-mcar-mnar/index_files/figure-html/dag-nomiss-1.png" class="img-fluid" width="1170"></p>
</div>
</div>
<p>This DAG is called a complete-data DAG, or <em>c-DAG</em>. It represents the causal relationships between the variables if all of them had been completely observed.</p>
<p>To represent possible causes of missing data, we can introduce three new variables in the DAG: <em>MX</em>, <em>MY</em> and <em>MZ2</em>, representing whether or not the exposure (<em>X</em>), outcome (<em>Y</em>), or partially-observed confounders (<em>Z2</em>) are missing. Think of them as binary indicator variables, where for example <em>MX</em> = 1 means that <em>X</em> wasn’t observed (for a particular case/participant/observation) and <em>MX</em> = 0 means that <em>X</em> was observed. Adding these variables produces a missingness DAG, or <em>m-DAG</em>. <span class="citation" data-cites="moreno-betancur_canonical_2018">Moreno-Betancur et al. (2018)</span> also considers unmeasured causes of missingness (<em>W</em>) which are not related to any of the substantive variables in the study but do affect the probability of missingness.</p>
<p>The variables in the DAG which aren’t prefixed with <em>M</em> still refer to values of the variables as if they had been completely observed — which we no longer have full access to in our real data since we only get to see the variables after the missingness mechanism has occurred. This ensures that the causal mechanism in the c-DAG still applies to the m-DAG, so the m-DAG can be produced by adding additional nodes and arrows to the c-DAG without changing any of the arrows between existing nodes.</p>
<p>If we turn the c-DAG above into an m-DAG by adding nodes for <em>MX</em>, <em>MY</em>, and <em>MZ2</em> but no additional arrows, the absence of arrows to <em>MX</em>, <em>MY</em> and <em>MZ2</em> would mean that there is no causal relationship between any of the variables and their missingness — in other words, the MCAR missingness mechanism. This scenario would be quite unusual in most real studies, unless the missing data was deliberately planned like our first example in the previous section.</p>
<p>This m-DAG is shown below, with an additional variable <em>W</em> representing unmeasured variables which affect the missing data process but are not related to any of the variables in the study. The new variables representing the missing data mechanism are shown in blue. In that MCAR scenario, the blue nodes (missing data mechanism) are completely disconnected from black nodes (relating to the main research question).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">dag_mcar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dagify</span>(</span>
<span id="cb2-2">  Y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z2,</span>
<span id="cb2-3">  X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> U,</span>
<span id="cb2-4">  Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> U,</span>
<span id="cb2-5">  Z2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> U,</span>
<span id="cb2-6">  MX <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> W,</span>
<span id="cb2-7">  MY <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> W,</span>
<span id="cb2-8">  MZ2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> W,</span>
<span id="cb2-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coords =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb2-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">U =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z1 =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z2 =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb2-11">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MX =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MY =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MZ2 =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">W =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb2-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">U =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z1 =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z2 =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-13">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MX =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MY =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MZ2 =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">W =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>)</span>
<span id="cb2-14">  )</span>
<span id="cb2-15">)</span>
<span id="cb2-16">dag_mcar <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy_dagitty</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb2-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">node_colour =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb2-20">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_starts</span>(name, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"W"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dodgerblue3"</span>,</span>
<span id="cb2-21">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.default =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span></span>
<span id="cb2-22">    ),</span>
<span id="cb2-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">edge_colour =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb2-24">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_starts</span>(to, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dodgerblue3"</span>,</span>
<span id="cb2-25">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.default =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span></span>
<span id="cb2-26">    )</span>
<span id="cb2-27">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> xend, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> yend)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dag_edges</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">edge_colour =</span> edge_colour)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dag_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> node_colour)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dag_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.88</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_dag</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_identity</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2023/06/untangling-mar-mcar-mnar/index_files/figure-html/dag-mcar-1.png" class="img-fluid" width="1170"></p>
</div>
</div>
<p>Figure 2 in <span class="citation" data-cites="moreno-betancur_canonical_2018">Moreno-Betancur et al. (2018)</span> provides 10 examples of m-DAGs, with different combinations of the following features:</p>
<ul>
<li>incomplete confounders and exposure related to missingness of other variables;</li>
<li>incomplete confounders and exposure related to their own missingness;</li>
<li>outcome related to missingness of other variables; and</li>
<li>outcome related to its own missingness.</li>
</ul>
<p>The first of these canonical DAGs, m-DAG A, is an example of a MAR process, where the missingness is only related to completely-observed confounders (<em>Z1</em>) and unmeasured variables unrelated to other variables in the study (<em>W</em>). This DAG describes Example 2 in the previous section, with participant location (part of <em>Z1</em>) causing missingness in other variables (<em>MX</em>, <em>MY</em>, <em>MZ2</em>). This DAG is reproduced below, with the nodes and arrows related to the missing data mechanism shown in blue:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">dag_a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dagify</span>(</span>
<span id="cb3-2">  Y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z2,</span>
<span id="cb3-3">  X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> U,</span>
<span id="cb3-4">  Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> U,</span>
<span id="cb3-5">  Z2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> U,</span>
<span id="cb3-6">  MX <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> W,</span>
<span id="cb3-7">  MY <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> W,</span>
<span id="cb3-8">  MZ2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> W,</span>
<span id="cb3-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coords =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb3-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">U =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z1 =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z2 =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb3-11">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MX =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MY =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MZ2 =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">W =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb3-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">U =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z1 =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z2 =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb3-13">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MX =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MY =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MZ2 =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">W =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>)</span>
<span id="cb3-14">  )</span>
<span id="cb3-15">)</span>
<span id="cb3-16">dag_a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy_dagitty</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb3-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">node_colour =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb3-20">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_starts</span>(name, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"W"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dodgerblue3"</span>,</span>
<span id="cb3-21">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.default =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span></span>
<span id="cb3-22">    ),</span>
<span id="cb3-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">edge_colour =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb3-24">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_starts</span>(to, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dodgerblue3"</span>,</span>
<span id="cb3-25">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.default =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span></span>
<span id="cb3-26">    )</span>
<span id="cb3-27">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> xend, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> yend)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dag_edges</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">edge_colour =</span> edge_colour)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dag_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> node_colour)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dag_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.88</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_dag</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_identity</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2023/06/untangling-mar-mcar-mnar/index_files/figure-html/dag-a-1.png" class="img-fluid" width="1170"></p>
</div>
</div>
<p>In this DAG, so long as the model’s adjustment for confounders is correctly specified (a big “if”!), both complete cases analysis and multiple imputation provide valid estimates of not just the relationship between the exposure and the outcome, but also the complete distribution of the outcome. This isn’t something that should be obvious just from looking at the DAG — there’s a derivation in the supplementary materials for <span class="citation" data-cites="moreno-betancur_canonical_2018">Moreno-Betancur et al. (2018)</span> for this and the other DAGs, with the results summarised in Tables 1 and 2 of that paper. Those who are familiar with causal DAGs may want to know that when there is missing data, this derivation is more complex than rules like “d-separation” and cannot be done algorithmically.</p>
<p>In other missing data situations, it may be possible to obtain a valid estimate of the effect of the exposure but not, for example, the population mean of the outcome. In some situations, it may not be possible to obtain a valid estimate of either.</p>
<p>The figure below shows m-DAG E, which is an example of an MNAR process. The arrows new to this DAG which weren’t in m-DAG A are shown in red. The probability of missingness in all variables is affected by both the exposure <em>X</em> (which may itself have missing values) and partially-observed confounders <em>Z2</em>. This DAG corresponds to Example 3 in the previous section, if we believe that missingness in child behaviour is not related to the missing values of child behaviour. Perhaps surprisingly, even though this missingness process is MNAR, it is possible to obtain a valid estimate of the relationship between the exposure and the outcome using either complete cases analysis or multiple imputation. However, it is not possible to recover the overall population mean of the outcome.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">dag_e <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dagify</span>(</span>
<span id="cb4-2">  Y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z2,</span>
<span id="cb4-3">  X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> U,</span>
<span id="cb4-4">  Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> U,</span>
<span id="cb4-5">  Z2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> U,</span>
<span id="cb4-6">  MX <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> W,</span>
<span id="cb4-7">  MY <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> W,</span>
<span id="cb4-8">  MZ2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> W,</span>
<span id="cb4-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coords =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb4-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">U =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z1 =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z2 =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb4-11">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MX =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MY =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MZ2 =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">W =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb4-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">U =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z1 =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z2 =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb4-13">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MX =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MY =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MZ2 =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">W =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>)</span>
<span id="cb4-14">  )</span>
<span id="cb4-15">)</span>
<span id="cb4-16">dag_e <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy_dagitty</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb4-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">node_colour =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb4-20">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_starts</span>(name, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"W"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dodgerblue3"</span>,</span>
<span id="cb4-21">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.default =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span></span>
<span id="cb4-22">    ),</span>
<span id="cb4-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">edge_colour =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb4-24">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_starts</span>(to, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z2"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick3"</span>,</span>
<span id="cb4-25">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_starts</span>(to, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dodgerblue3"</span>,</span>
<span id="cb4-26">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.default =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span></span>
<span id="cb4-27">    )</span>
<span id="cb4-28">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> xend, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> yend)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dag_edges</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">edge_colour =</span> edge_colour)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dag_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> node_colour)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dag_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.88</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_dag</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_identity</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2023/06/untangling-mar-mcar-mnar/index_files/figure-html/dag-e-1.png" class="img-fluid" width="1170"></p>
</div>
</div>
<p>The final example in this blog is m-DAG J, which is another MNAR process. The arrows new to this DAG are shown in purple. In this example, missingness is also affected by the value of the outcome <em>Y</em>. This DAG is similar to the one for Example 3 in the previous section, if we believe that missingness in the outcome (child behaviour) is related to its own unobserved values. For this m-DAG, it is not possible to recover the relationship between the outcome and the exposure.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">dag_j <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dagify</span>(</span>
<span id="cb5-2">  Y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z2,</span>
<span id="cb5-3">  X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> U,</span>
<span id="cb5-4">  Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> U,</span>
<span id="cb5-5">  Z2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> U,</span>
<span id="cb5-6">  MX <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> W,</span>
<span id="cb5-7">  MY <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> W,</span>
<span id="cb5-8">  MZ2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Z1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Z2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> W,</span>
<span id="cb5-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coords =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb5-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">U =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z1 =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z2 =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb5-11">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MX =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MY =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MZ2 =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">W =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb5-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">U =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z1 =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z2 =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb5-13">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MX =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MY =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MZ2 =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.75</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">W =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>)</span>
<span id="cb5-14">  )</span>
<span id="cb5-15">)</span>
<span id="cb5-16">dag_j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy_dagitty</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb5-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">node_colour =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb5-20">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_starts</span>(name, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"W"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dodgerblue3"</span>,</span>
<span id="cb5-21">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.default =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span></span>
<span id="cb5-22">    ),</span>
<span id="cb5-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">edge_colour =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb5-24">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_starts</span>(to, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkorchid3"</span>,</span>
<span id="cb5-25">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_starts</span>(to, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z2"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"firebrick3"</span>,</span>
<span id="cb5-26">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_starts</span>(to, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dodgerblue3"</span>,</span>
<span id="cb5-27">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.default =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span></span>
<span id="cb5-28">    )</span>
<span id="cb5-29">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> xend, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> yend)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dag_edges</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">edge_colour =</span> edge_colour)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dag_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> node_colour)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dag_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.88</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_dag</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_identity</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2023/06/untangling-mar-mcar-mnar/index_files/figure-html/dag-j-1.png" class="img-fluid" width="1170"></p>
</div>
</div>
<p>If you have an m-DAG where a quantity of interest cannot be recovered, you can consider doing a sensitivity analysis using a <img src="https://latex.codecogs.com/png.latex?%5Cdelta">-adjustment. This process is described in popular texts on missing data, e.g. <span class="citation" data-cites="van_buuren_flexible_2018">van Buuren (2018)</span> sec 9.2 (also <a href="https://stefvanbuuren.name/fimd/sec-sensitivity.html">available online</a>) or <span class="citation" data-cites="molenberghs_handbook_2015">Molenberghs et al. (2015)</span>.</p>
</section>
<section id="applying-dags-to-real-missing-data-problems" class="level2">
<h2 class="anchored" data-anchor-id="applying-dags-to-real-missing-data-problems">Applying DAGs to real missing data problems</h2>
<p>This section draws heavily from <span class="citation" data-cites="lee_assumptions_2023">Lee et al. (2023)</span> — especially Figure 1 of that paper — which provides practical guidance for data analysis using missingness DAGs.</p>
<p>Start by determining the estimand of interest: the scientific quantity you would like to estimate, if you had access to the complete data.</p>
<p>Next, draw a DAG representing the causal relationships between your variables and their possible reasons for being missing. This will require some thinking about which arrows are plausible and which are not, based on your understanding of the real-world relationships between variables and the way the data has been collected.</p>
<p>Before deciding on an analysis method, you must first determine whether the estimand is recoverable, i.e.&nbsp;whether it is possible to estimate it from the data<sup>4</sup>. One possibility is to compare your DAG to the canonical DAGs in <span class="citation" data-cites="moreno-betancur_canonical_2018">Moreno-Betancur et al. (2018)</span> and the recoverability results in Table 1 of that paper.</p>
<p>If your estimand is recoverable, you can proceed to deciding on an analysis method to handle the missing data. Again, the canonical DAGs are useful for this. For canonical DAGs A, B, D and E, complete cases analysis was shown to provide a valid estimate of the relationship between the outcome and the exposure. For canonical DAGs A, B, C, D and E, multiple imputation was shown to provide a valid estimate of the relationship between the outcome and the exposure.</p>
<p>Randomised clinical trials provide some additional guarantees about the nature of the missing data process which observational studies do not: the assigned intervention is completely observed and known to be unrelated to baseline covariates. While it doesn’t use the m-DAG framework, <span class="citation" data-cites="sullivan_should_2018">Sullivan et al. (2018)</span> considers several methods for dealing with missing data in randomised trials that may be useful for those working in that setting.</p>
<p>The papers above provide examples of situations where multiple imputation is not necessarily better than simpler methods, as well as situations where multiple imputation is required. The situations where particular missing data methods work do not neatly align with the definitions of MCAR/MAR/MNAR but by drawing a DAG and considering the results in the papers above you should be able to determine which popular methods are applicable to your data and research question.</p>
<div style="font-size:80%">
<p>Thanks to Isabella Ghement and Lachlan Cribb for providing valuable feedback which greatly improved this blog post. Last updated: 29 June 2023.</p>
</div>
</section>
<section id="references" class="level2">




</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2">
<div id="ref-collins_comparison_2001" class="csl-entry">
Collins, L. M., Schafer, J. L., &amp; Kam, C.-M. (2001). A comparison of inclusive and restrictive strategies in modern missing data procedures. <em>Psychological Methods</em>, <em>6</em>(4), 330–351. <a href="https://doi.org/10.1037/1082-989X.6.4.330">https://doi.org/10.1037/1082-989X.6.4.330</a>
</div>
<div id="ref-lee_assumptions_2023" class="csl-entry">
Lee, K. J., Carlin, J. B., Simpson, J. A., &amp; Moreno-Betancur, M. (2023). Assumptions and analysis planning in studies with missing data in multiple variables: Moving beyond the <span>MCAR</span>/<span>MAR</span>/<span>MNAR</span> classification. <em>International Journal of Epidemiology</em>, dyad008. <a href="https://doi.org/10.1093/ije/dyad008">https://doi.org/10.1093/ije/dyad008</a>
</div>
<div id="ref-lee_framework_2021" class="csl-entry">
Lee, K. J., Tilling, K. M., Cornish, R. P., Little, R. J. A., Bell, M. L., Goetghebeur, E., Hogan, J. W., &amp; Carpenter, J. R. (2021). Framework for the treatment and reporting of missing data in observational studies: <span>The</span> <span>Treatment</span> <span>And</span> <span>Reporting</span> of <span>Missing</span> data in <span>Observational</span> <span>Studies</span> framework. <em>Journal of Clinical Epidemiology</em>, <em>134</em>, 79–88. <a href="https://doi.org/10.1016/j.jclinepi.2021.01.008">https://doi.org/10.1016/j.jclinepi.2021.01.008</a>
</div>
<div id="ref-little_missing_2021" class="csl-entry">
Little, R. J. A. (2021). Missing <span>Data</span> <span>Assumptions</span>. <em>Annual Review of Statistics and Its Application</em>, <em>8</em>(1), 89–107. <a href="https://doi.org/10.1146/annurev-statistics-040720-031104">https://doi.org/10.1146/annurev-statistics-040720-031104</a>
</div>
<div id="ref-little_statistical_2014" class="csl-entry">
Little, R. J. A., &amp; Rubin, D. B. (2014). <em>Statistical analysis with missing data</em> (Second edition). John Wiley &amp; Sons.
</div>
<div id="ref-marini_maximum-likelihood_1980" class="csl-entry">
Marini, M. M., Olsen, A. R., &amp; Rubin, D. B. (1980). Maximum-<span>Likelihood</span> <span>Estimation</span> in <span>Panel</span> <span>Studies</span> with <span>Missing</span> <span>Data</span>. <em>Sociological Methodology</em>, <em>11</em>, 314. <a href="https://doi.org/10.2307/270868">https://doi.org/10.2307/270868</a>
</div>
<div id="ref-mohan_graphical_2014" class="csl-entry">
Mohan, K., &amp; Pearl, J. (2014). Graphical <span>Models</span> for <span>Recovering</span> <span>Probabilistic</span> and <span>Causal</span> <span>Queries</span> from <span>Missing</span> <span>Data</span>. <em>Proceedings of the 27th <span>International</span> <span>Conference</span> on <span>Neural</span> <span>Information</span> <span>Processing</span> <span>Systems</span> - <span>Volume</span> 1</em>, 1520–1528.
</div>
<div id="ref-molenberghs_handbook_2015" class="csl-entry">
Molenberghs, G., Fitzmaurice, G. M., Kenward, M. G., Tsiatis, A. A., &amp; Verbeke, G. (Eds.). (2015). <em>Handbook of missing data methodology</em>. CRC Press, Taylor &amp; Francis Group.
</div>
<div id="ref-moreno-betancur_canonical_2018" class="csl-entry">
Moreno-Betancur, M., Lee, K. J., Leacy, F. P., White, I. R., Simpson, J. A., &amp; Carlin, J. B. (2018). Canonical <span>Causal</span> <span>Diagrams</span> to <span>Guide</span> the <span>Treatment</span> of <span>Missing</span> <span>Data</span> in <span>Epidemiologic</span> <span>Studies</span>. <em>American Journal of Epidemiology</em>, <em>187</em>(12), 2705–2715. <a href="https://doi.org/10.1093/aje/kwy173">https://doi.org/10.1093/aje/kwy173</a>
</div>
<div id="ref-pearl_causal_1995" class="csl-entry">
Pearl, J. (1995). Causal diagrams for empirical research. <em>Biometrika</em>, <em>82</em>(4), 669–688. <a href="https://doi.org/10.1093/biomet/82.4.669">https://doi.org/10.1093/biomet/82.4.669</a>
</div>
<div id="ref-rubin_inference_1976" class="csl-entry">
Rubin, D. B. (1976). Inference and missing data. <em>Biometrika</em>, <em>63</em>(3), 581–592. <a href="https://doi.org/10.1093/biomet/63.3.581">https://doi.org/10.1093/biomet/63.3.581</a>
</div>
<div id="ref-seaman_what_2013" class="csl-entry">
Seaman, S., Galati, J., Jackson, D., &amp; Carlin, J. (2013). What <span>Is</span> <span>Meant</span> by <span>“<span>Missing</span> at <span>Random</span>”</span>? <em>Statistical Science</em>, <em>28</em>(2). <a href="https://doi.org/10.1214/13-STS415">https://doi.org/10.1214/13-STS415</a>
</div>
<div id="ref-sullivan_should_2018" class="csl-entry">
Sullivan, T. R., White, I. R., Salter, A. B., Ryan, P., &amp; Lee, K. J. (2018). Should multiple imputation be the method of choice for handling missing data in randomized trials? <em>Statistical Methods in Medical Research</em>, <em>27</em>(9), 2610–2626. <a href="https://doi.org/10.1177/0962280216683570">https://doi.org/10.1177/0962280216683570</a>
</div>
<div id="ref-textor_robust_2017" class="csl-entry">
Textor, J., Van Der Zander, B., Gilthorpe, M. S., Liśkiewicz, M., &amp; Ellison, G. T. H. (2017). Robust causal inference using directed acyclic graphs: The <span>R</span> package <span>“dagitty.”</span> <em>International Journal of Epidemiology</em>, dyw341. <a href="https://doi.org/10.1093/ije/dyw341">https://doi.org/10.1093/ije/dyw341</a>
</div>
<div id="ref-van_buuren_flexible_2018" class="csl-entry">
van Buuren, S. (2018). <em>Flexible imputation of missing data</em> (Second edition). CRC Press, Taylor; Francis Group.
</div>
<div id="ref-white_bias_2010" class="csl-entry">
White, I. R., &amp; Carlin, J. B. (2010). Bias and efficiency of multiple imputation compared with complete-case analysis for missing covariate values. <em>Statistics in Medicine</em>, <em>29</em>(28), 2920–2931. <a href="https://doi.org/10.1002/sim.3944">https://doi.org/10.1002/sim.3944</a>
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>There are a few subtly different ways of defining this concept mathematically; <span class="citation" data-cites="seaman_what_2013">Seaman et al. (2013)</span> goes into the detail for those who are interested.↩︎</p></li>
<li id="fn2"><p>A “cycle” in mathematician-speak. Hence, directed (arrows have a direction) acyclic (can never get back to where you started) graph (set of nodes and edges).↩︎</p></li>
<li id="fn3"><p>That’s epidemiologist-speak for the main predictor of interest.↩︎</p></li>
<li id="fn4"><p>This step is analogous to determining identifiability in causal inference.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>missing-data</category>
  <category>statistics</category>
  <guid>https://cameronpatrick.com/post/2023/06/untangling-mar-mcar-mnar/index.html</guid>
  <pubDate>Tue, 27 Jun 2023 14:00:00 GMT</pubDate>
</item>
<item>
  <title>Fitting many statistical models at once using dplyr</title>
  <dc:creator>Cameron Patrick</dc:creator>
  <link>https://cameronpatrick.com/post/2023/06/dplyr-fitting-multiple-models-at-once/index.html</link>
  <description><![CDATA[ 




<p>One common task in applied statistics is to fit and interpret a number of statistical models at once. For example, fitting a model with the same structure to a number of different outcome or explanatory variables, or fitting several models with different structure to the same data. Here are some examples of how I usually do this, using features that were introduced with <code>dplyr</code> version 1.1.0.</p>
<p>For this demonstration, we’ll be using the R packages <code>dplyr</code>, <code>tidyr</code>, <code>ggplot2</code> (all of which are included in the <code>tidyverse</code>), as well as <code>gt</code> for making tables, <code>emmeans</code> for obtaining estimated means and comparisons, and <code>performance</code> for model-checking.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(gt)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(emmeans)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(performance)</span></code></pre></div>
</div>
<p>We’ll be using the <a href="https://allisonhorst.github.io/palmerpenguins/">Palmer Penguins data</a> collected at Palmer Station, Antarctica, made available by Dr Kristen Gorman, and conveniently accessible in R using the <code>palmerpenguins</code> package. This dataset contains measurements on a number of penguins of different species on different islands.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(palmerpenguins)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(penguins)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(penguins)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Adelie  Torgersen           39.1          18.7               181        3750
2 Adelie  Torgersen           39.5          17.4               186        3800
3 Adelie  Torgersen           40.3          18                 195        3250
4 Adelie  Torgersen           NA            NA                  NA          NA
5 Adelie  Torgersen           36.7          19.3               193        3450
6 Adelie  Torgersen           39.3          20.6               190        3650
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
<p>Suppose we want to compare bill length, bill depth, flipper length, and body mass between species. We could manually run a separate model for each, but here’s a way to to automate the process. As with many things in R, the trick to doing this easily is to get the data in long form, with the outcomes stacked on top of each other, and a variable indicating which outcome is being measured.</p>
<p>The <code>pivot_longer()</code> function from <code>tidyr</code> gets the data into this format. I’ve also taken an extra step of recoding the “outcome” variable to give more descriptive labels. This isn’t required but it will make the tables and plots that we make later look nicer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">penguins_long <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> penguins <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb4-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g),</span>
<span id="cb4-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"outcome"</span>,</span>
<span id="cb4-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span></span>
<span id="cb4-6">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb4-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">outcome =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_inorder</span>(outcome),</span>
<span id="cb4-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">outcome =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_recode</span>(</span>
<span id="cb4-10">      outcome,</span>
<span id="cb4-11">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bill length (mm)"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bill_length_mm"</span>,</span>
<span id="cb4-12">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bill depth (mm)"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bill_depth_mm"</span>,</span>
<span id="cb4-13">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Flipper length (mm)"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"flipper_length_mm"</span>,</span>
<span id="cb4-14">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Body mass (g)"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"body_mass_g"</span></span>
<span id="cb4-15">    )</span>
<span id="cb4-16">  )</span></code></pre></div>
</div>
<p>Looking at the first few rows of this data frame, you can see we now have four rows for each penguin, one for each type of measurement:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(penguins_long)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  species island    sex     year outcome              value
  &lt;fct&gt;   &lt;fct&gt;     &lt;fct&gt;  &lt;int&gt; &lt;fct&gt;                &lt;dbl&gt;
1 Adelie  Torgersen male    2007 Bill length (mm)      39.1
2 Adelie  Torgersen male    2007 Bill depth (mm)       18.7
3 Adelie  Torgersen male    2007 Flipper length (mm)  181  
4 Adelie  Torgersen male    2007 Body mass (g)       3750  
5 Adelie  Torgersen female  2007 Bill length (mm)      39.5
6 Adelie  Torgersen female  2007 Bill depth (mm)       17.4</code></pre>
</div>
</div>
<p>We can use <code>group_by()</code> and <code>summarise()</code> from the <code>dplyr</code> package to group the rows by outcome, and then “summarise” these groups of rows down to a single row containing a statistical model for each outcome. This makes use of a couple of R tricks: ‘list columns’, a column in a data frame that contains a more complex object than the standard R data types (numeric, character, etc); and the new <code>pick()</code> verb which returns a data frame containing selected columns (in this case, all of them) within the group that’s being operated on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">penguin_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> penguins_long <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(outcome) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(</span>
<span id="cb7-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb7-5">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> species, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pick</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">everything</span>()))</span>
<span id="cb7-6">    )</span>
<span id="cb7-7">  )</span></code></pre></div>
</div>
<p>You can see the resulting data from contains four rows, one for each outcome, and a statistical model (“lm”) for each:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(penguin_models)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  outcome             model 
  &lt;fct&gt;               &lt;list&gt;
1 Bill length (mm)    &lt;lm&gt;  
2 Bill depth (mm)     &lt;lm&gt;  
3 Flipper length (mm) &lt;lm&gt;  
4 Body mass (g)       &lt;lm&gt;  </code></pre>
</div>
</div>
<p>Ideally we would also do a visual check of model assumptions. One way to do this is something like the code below, which saves a residual plot for each model to an image file, which can be inspected later. It uses the <code>check_model()</code> function in the <code>performance</code> package to generate the plots. The generated residual plots aren’t shown here, but they all look fine.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">walk2</span>(</span>
<span id="cb10-2">  penguin_models<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>outcome, </span>
<span id="cb10-3">  penguin_models<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>model,</span>
<span id="cb10-4">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(</span>
<span id="cb10-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(.x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".png"</span>),</span>
<span id="cb10-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">check_model</span>(.y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">check =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pp_check"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"linearity"</span>,</span>
<span id="cb10-7">                                   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"homogeneity"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"qq"</span>))),</span>
<span id="cb10-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,</span>
<span id="cb10-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span></span>
<span id="cb10-10">  )</span>
<span id="cb10-11">)</span></code></pre></div>
</div>
<p>Once we’ve fitted the models, we can obtain quantities of interest from them. In this example we’ll look at estimated means for each species, p-values testing the hypothesis that all species means are equal (against at least one pair of means being different), and comparisons (differences in means) between all pairs of species.</p>
<p>The <code>reframe()</code> function from <code>dplyr</code> allows us to run some code that produces a data frame on each model and stack the results on top of each other. We can use the <code>emmeans()</code> function from the <code>emmeans</code> package to obtain estimated marginal means and <code>as_tibble()</code> to convert the result into a data frame. The <code>rowwise(outcome)</code> at the start tells <code>reframe()</code> that we want to call <code>emmeans()</code> separately for each row of the data frame (i.e., each outcome model), and preserve the <code>outcome</code> variable in the result.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">penguin_means <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> penguin_models <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>(outcome) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reframe</span>(</span>
<span id="cb11-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">emmeans</span>(model, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-5">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>()</span>
<span id="cb11-6">  )</span></code></pre></div>
</div>
<p>The first few rows of the resulting data frame are shown below. There is a row for each outcome for each species, containing the mean (<code>emmean</code>), standard error (<code>SE</code>), degrees of freedom (<code>df</code>) and lower and upper confidence limits (<code>lower.CL</code> and <code>upper.CL</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(penguin_means)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
  outcome          species   emmean     SE    df lower.CL upper.CL
  &lt;fct&gt;            &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 Bill length (mm) Adelie      38.8 0.241    339     38.3     39.3
2 Bill length (mm) Chinstrap   48.8 0.359    339     48.1     49.5
3 Bill length (mm) Gentoo      47.5 0.267    339     47.0     48.0
4 Bill depth (mm)  Adelie      18.3 0.0912   339     18.2     18.5
5 Bill depth (mm)  Chinstrap   18.4 0.136    339     18.2     18.7
6 Bill depth (mm)  Gentoo      15.0 0.101    339     14.8     15.2</code></pre>
</div>
</div>
<p>We can use <code>ggplot()</code> to present the results visually. The plot shows that there’s a substantial variation between species in means of all of these measurements, with little or no overlap between many of the confidence intervals. Gentoo penguins appear to be heavier, and have longer flippers but shorter and shallower bills, than the other species.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">penguin_means <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> emmean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> species, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmin =</span> lower.CL, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmax =</span> upper.CL)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_errorbar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> rev) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(outcome), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb14-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean"</span>, </span>
<span id="cb14-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Species"</span>,</span>
<span id="cb14-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Error bars show 95% confidence interval for mean."</span></span>
<span id="cb14-11">  )</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2023/06/dplyr-fitting-multiple-models-at-once/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="1170"></p>
</div>
</div>
<p>The <code>gt()</code> function can be used to produce a nice table of results. The code shown below combines the <code>lower.CL</code> and <code>upper.CL</code> columns to produce a single column with the confidence interval, and separately specifies fewer decimal places for body mass than the other measures. The <code>group_by()</code> function before <code>gt()</code> results in a table sub-heading for each outcome. You could easily change this to <code>group_by(species)</code> to arrange the results by species.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">penguin_means <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(outcome) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gt</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fmt_number</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(emmean, SE, lower.CL, upper.CL),</span>
<span id="cb15-5">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decimals =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">use_seps =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fmt_number</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(emmean, SE, lower.CL, upper.CL),</span>
<span id="cb15-7">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rows =</span> outcome <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Body mass (g)"</span>,</span>
<span id="cb15-8">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decimals =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">use_seps =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fmt_number</span>(df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decimals =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cols_align</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>, species) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cols_merge_range</span>(lower.CL, upper.CL, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">", "</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cols_label</span>(</span>
<span id="cb15-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">species =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Species"</span>,</span>
<span id="cb15-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">emmean =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean"</span>,</span>
<span id="cb15-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower.CL =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"95% Confidence Interval"</span></span>
<span id="cb15-16">  )</span></code></pre></div>
<div class="cell-output-display">

<div id="rszjvtckrc" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rszjvtckrc table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rszjvtckrc thead, #rszjvtckrc tbody, #rszjvtckrc tfoot, #rszjvtckrc tr, #rszjvtckrc td, #rszjvtckrc th {
  border-style: none;
}

#rszjvtckrc p {
  margin: 0;
  padding: 0;
}

#rszjvtckrc .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rszjvtckrc .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rszjvtckrc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rszjvtckrc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rszjvtckrc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rszjvtckrc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rszjvtckrc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rszjvtckrc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rszjvtckrc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rszjvtckrc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rszjvtckrc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rszjvtckrc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rszjvtckrc .gt_spanner_row {
  border-bottom-style: hidden;
}

#rszjvtckrc .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rszjvtckrc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rszjvtckrc .gt_from_md > :first-child {
  margin-top: 0;
}

#rszjvtckrc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rszjvtckrc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rszjvtckrc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rszjvtckrc .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rszjvtckrc .gt_row_group_first td {
  border-top-width: 2px;
}

#rszjvtckrc .gt_row_group_first th {
  border-top-width: 2px;
}

#rszjvtckrc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rszjvtckrc .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rszjvtckrc .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rszjvtckrc .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rszjvtckrc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rszjvtckrc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rszjvtckrc .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rszjvtckrc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rszjvtckrc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rszjvtckrc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rszjvtckrc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rszjvtckrc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rszjvtckrc .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rszjvtckrc .gt_left {
  text-align: left;
}

#rszjvtckrc .gt_center {
  text-align: center;
}

#rszjvtckrc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rszjvtckrc .gt_font_normal {
  font-weight: normal;
}

#rszjvtckrc .gt_font_bold {
  font-weight: bold;
}

#rszjvtckrc .gt_font_italic {
  font-style: italic;
}

#rszjvtckrc .gt_super {
  font-size: 65%;
}

#rszjvtckrc .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rszjvtckrc .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rszjvtckrc .gt_indent_1 {
  text-indent: 5px;
}

#rszjvtckrc .gt_indent_2 {
  text-indent: 10px;
}

#rszjvtckrc .gt_indent_3 {
  text-indent: 15px;
}

#rszjvtckrc .gt_indent_4 {
  text-indent: 20px;
}

#rszjvtckrc .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Species">Species</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Mean">Mean</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="SE">SE</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="df">df</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="95% Confidence Interval">95% Confidence Interval</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr class="gt_group_heading_row">
      <th colspan="5" class="gt_group_heading" scope="colgroup" id="Bill length (mm)">Bill length (mm)</th>
    </tr>
    <tr class="gt_row_group_first"><td headers="Bill length (mm)  species" class="gt_row gt_left">Adelie</td>
<td headers="Bill length (mm)  emmean" class="gt_row gt_right">38.8</td>
<td headers="Bill length (mm)  SE" class="gt_row gt_right">0.2</td>
<td headers="Bill length (mm)  df" class="gt_row gt_right">339</td>
<td headers="Bill length (mm)  lower.CL" class="gt_row gt_right">38.3, 39.3</td></tr>
    <tr><td headers="Bill length (mm)  species" class="gt_row gt_left">Chinstrap</td>
<td headers="Bill length (mm)  emmean" class="gt_row gt_right">48.8</td>
<td headers="Bill length (mm)  SE" class="gt_row gt_right">0.4</td>
<td headers="Bill length (mm)  df" class="gt_row gt_right">339</td>
<td headers="Bill length (mm)  lower.CL" class="gt_row gt_right">48.1, 49.5</td></tr>
    <tr><td headers="Bill length (mm)  species" class="gt_row gt_left">Gentoo</td>
<td headers="Bill length (mm)  emmean" class="gt_row gt_right">47.5</td>
<td headers="Bill length (mm)  SE" class="gt_row gt_right">0.3</td>
<td headers="Bill length (mm)  df" class="gt_row gt_right">339</td>
<td headers="Bill length (mm)  lower.CL" class="gt_row gt_right">47.0, 48.0</td></tr>
    <tr class="gt_group_heading_row">
      <th colspan="5" class="gt_group_heading" scope="colgroup" id="Bill depth (mm)">Bill depth (mm)</th>
    </tr>
    <tr class="gt_row_group_first"><td headers="Bill depth (mm)  species" class="gt_row gt_left">Adelie</td>
<td headers="Bill depth (mm)  emmean" class="gt_row gt_right">18.3</td>
<td headers="Bill depth (mm)  SE" class="gt_row gt_right">0.1</td>
<td headers="Bill depth (mm)  df" class="gt_row gt_right">339</td>
<td headers="Bill depth (mm)  lower.CL" class="gt_row gt_right">18.2, 18.5</td></tr>
    <tr><td headers="Bill depth (mm)  species" class="gt_row gt_left">Chinstrap</td>
<td headers="Bill depth (mm)  emmean" class="gt_row gt_right">18.4</td>
<td headers="Bill depth (mm)  SE" class="gt_row gt_right">0.1</td>
<td headers="Bill depth (mm)  df" class="gt_row gt_right">339</td>
<td headers="Bill depth (mm)  lower.CL" class="gt_row gt_right">18.2, 18.7</td></tr>
    <tr><td headers="Bill depth (mm)  species" class="gt_row gt_left">Gentoo</td>
<td headers="Bill depth (mm)  emmean" class="gt_row gt_right">15.0</td>
<td headers="Bill depth (mm)  SE" class="gt_row gt_right">0.1</td>
<td headers="Bill depth (mm)  df" class="gt_row gt_right">339</td>
<td headers="Bill depth (mm)  lower.CL" class="gt_row gt_right">14.8, 15.2</td></tr>
    <tr class="gt_group_heading_row">
      <th colspan="5" class="gt_group_heading" scope="colgroup" id="Flipper length (mm)">Flipper length (mm)</th>
    </tr>
    <tr class="gt_row_group_first"><td headers="Flipper length (mm)  species" class="gt_row gt_left">Adelie</td>
<td headers="Flipper length (mm)  emmean" class="gt_row gt_right">190.0</td>
<td headers="Flipper length (mm)  SE" class="gt_row gt_right">0.5</td>
<td headers="Flipper length (mm)  df" class="gt_row gt_right">339</td>
<td headers="Flipper length (mm)  lower.CL" class="gt_row gt_right">188.9, 191.0</td></tr>
    <tr><td headers="Flipper length (mm)  species" class="gt_row gt_left">Chinstrap</td>
<td headers="Flipper length (mm)  emmean" class="gt_row gt_right">195.8</td>
<td headers="Flipper length (mm)  SE" class="gt_row gt_right">0.8</td>
<td headers="Flipper length (mm)  df" class="gt_row gt_right">339</td>
<td headers="Flipper length (mm)  lower.CL" class="gt_row gt_right">194.2, 197.4</td></tr>
    <tr><td headers="Flipper length (mm)  species" class="gt_row gt_left">Gentoo</td>
<td headers="Flipper length (mm)  emmean" class="gt_row gt_right">217.2</td>
<td headers="Flipper length (mm)  SE" class="gt_row gt_right">0.6</td>
<td headers="Flipper length (mm)  df" class="gt_row gt_right">339</td>
<td headers="Flipper length (mm)  lower.CL" class="gt_row gt_right">216.0, 218.4</td></tr>
    <tr class="gt_group_heading_row">
      <th colspan="5" class="gt_group_heading" scope="colgroup" id="Body mass (g)">Body mass (g)</th>
    </tr>
    <tr class="gt_row_group_first"><td headers="Body mass (g)  species" class="gt_row gt_left">Adelie</td>
<td headers="Body mass (g)  emmean" class="gt_row gt_right">3701</td>
<td headers="Body mass (g)  SE" class="gt_row gt_right">38</td>
<td headers="Body mass (g)  df" class="gt_row gt_right">339</td>
<td headers="Body mass (g)  lower.CL" class="gt_row gt_right">3627, 3775</td></tr>
    <tr><td headers="Body mass (g)  species" class="gt_row gt_left">Chinstrap</td>
<td headers="Body mass (g)  emmean" class="gt_row gt_right">3733</td>
<td headers="Body mass (g)  SE" class="gt_row gt_right">56</td>
<td headers="Body mass (g)  df" class="gt_row gt_right">339</td>
<td headers="Body mass (g)  lower.CL" class="gt_row gt_right">3623, 3843</td></tr>
    <tr><td headers="Body mass (g)  species" class="gt_row gt_left">Gentoo</td>
<td headers="Body mass (g)  emmean" class="gt_row gt_right">5076</td>
<td headers="Body mass (g)  SE" class="gt_row gt_right">42</td>
<td headers="Body mass (g)  df" class="gt_row gt_right">339</td>
<td headers="Body mass (g)  lower.CL" class="gt_row gt_right">4994, 5158</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>We can do similar to produce an overall “F” test for each model, testing the hypothesis that all species have equal means for a particular measure against the hypothesis that at least one pair of means is different. The <code>joint_tests()</code> function in <code>emmeans</code> does this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">penguin_tests <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> penguin_models <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>(outcome) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb16-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reframe</span>(</span>
<span id="cb16-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">joint_tests</span>(model) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb16-5">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>()</span>
<span id="cb16-6">  )</span></code></pre></div>
</div>
<p>The resulting data frame is shown below. This time there is one row per model, but if there had been multiple variables in the model, there would have been one row per variable or interaction term (distinguished by the <code>model term</code> column). Each row contains the results of a hypothesis test: numerator and denominator degrees of freedom (<code>df1</code> and <code>df2</code>), F-statistics (<code>F.ratio</code>) and p-value (<code>p.value</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(penguin_tests)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 6
  outcome             `model term`   df1   df2 F.ratio   p.value
  &lt;fct&gt;               &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
1 Bill length (mm)    species          2   339    411. 2.69e- 91
2 Bill depth (mm)     species          2   339    360. 1.51e- 84
3 Flipper length (mm) species          2   339    595. 1.35e-111
4 Body mass (g)       species          2   339    344. 2.89e- 82</code></pre>
</div>
</div>
<p>Again, this can be presented in a table using <code>gt()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">penguin_tests <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb19-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gt</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb19-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fmt_number</span>(F.ratio, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decimals =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb19-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fmt_number</span>(p.value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decimals =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb19-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cols_merge_range</span>(df1, df2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">", "</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb19-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub_small_vals</span>(p.value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">threshold =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb19-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cols_label</span>(</span>
<span id="cb19-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">outcome =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Outcome"</span>,</span>
<span id="cb19-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model term</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predictor"</span>,</span>
<span id="cb19-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df1 =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"df"</span>,</span>
<span id="cb19-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">F.ratio =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span>,</span>
<span id="cb19-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p.value =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p-value"</span></span>
<span id="cb19-13">  )</span></code></pre></div>
<div class="cell-output-display">

<div id="zdbfwnsyjv" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#zdbfwnsyjv table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#zdbfwnsyjv thead, #zdbfwnsyjv tbody, #zdbfwnsyjv tfoot, #zdbfwnsyjv tr, #zdbfwnsyjv td, #zdbfwnsyjv th {
  border-style: none;
}

#zdbfwnsyjv p {
  margin: 0;
  padding: 0;
}

#zdbfwnsyjv .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#zdbfwnsyjv .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#zdbfwnsyjv .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#zdbfwnsyjv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#zdbfwnsyjv .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zdbfwnsyjv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zdbfwnsyjv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zdbfwnsyjv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#zdbfwnsyjv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#zdbfwnsyjv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#zdbfwnsyjv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#zdbfwnsyjv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#zdbfwnsyjv .gt_spanner_row {
  border-bottom-style: hidden;
}

#zdbfwnsyjv .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#zdbfwnsyjv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#zdbfwnsyjv .gt_from_md > :first-child {
  margin-top: 0;
}

#zdbfwnsyjv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#zdbfwnsyjv .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#zdbfwnsyjv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#zdbfwnsyjv .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#zdbfwnsyjv .gt_row_group_first td {
  border-top-width: 2px;
}

#zdbfwnsyjv .gt_row_group_first th {
  border-top-width: 2px;
}

#zdbfwnsyjv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zdbfwnsyjv .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#zdbfwnsyjv .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#zdbfwnsyjv .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zdbfwnsyjv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zdbfwnsyjv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#zdbfwnsyjv .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#zdbfwnsyjv .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#zdbfwnsyjv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zdbfwnsyjv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zdbfwnsyjv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zdbfwnsyjv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zdbfwnsyjv .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zdbfwnsyjv .gt_left {
  text-align: left;
}

#zdbfwnsyjv .gt_center {
  text-align: center;
}

#zdbfwnsyjv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#zdbfwnsyjv .gt_font_normal {
  font-weight: normal;
}

#zdbfwnsyjv .gt_font_bold {
  font-weight: bold;
}

#zdbfwnsyjv .gt_font_italic {
  font-style: italic;
}

#zdbfwnsyjv .gt_super {
  font-size: 65%;
}

#zdbfwnsyjv .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#zdbfwnsyjv .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#zdbfwnsyjv .gt_indent_1 {
  text-indent: 5px;
}

#zdbfwnsyjv .gt_indent_2 {
  text-indent: 10px;
}

#zdbfwnsyjv .gt_indent_3 {
  text-indent: 15px;
}

#zdbfwnsyjv .gt_indent_4 {
  text-indent: 20px;
}

#zdbfwnsyjv .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Outcome">Outcome</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Predictor">Predictor</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="df">df</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="F">F</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="p-value">p-value</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="outcome" class="gt_row gt_center">Bill length (mm)</td>
<td headers="model term" class="gt_row gt_left">species</td>
<td headers="df1" class="gt_row gt_right">2, 339</td>
<td headers="F.ratio" class="gt_row gt_right">410.6</td>
<td headers="p.value" class="gt_row gt_right">&lt;0.001</td></tr>
    <tr><td headers="outcome" class="gt_row gt_center">Bill depth (mm)</td>
<td headers="model term" class="gt_row gt_left">species</td>
<td headers="df1" class="gt_row gt_right">2, 339</td>
<td headers="F.ratio" class="gt_row gt_right">359.8</td>
<td headers="p.value" class="gt_row gt_right">&lt;0.001</td></tr>
    <tr><td headers="outcome" class="gt_row gt_center">Flipper length (mm)</td>
<td headers="model term" class="gt_row gt_left">species</td>
<td headers="df1" class="gt_row gt_right">2, 339</td>
<td headers="F.ratio" class="gt_row gt_right">594.8</td>
<td headers="p.value" class="gt_row gt_right">&lt;0.001</td></tr>
    <tr><td headers="outcome" class="gt_row gt_center">Body mass (g)</td>
<td headers="model term" class="gt_row gt_left">species</td>
<td headers="df1" class="gt_row gt_right">2, 339</td>
<td headers="F.ratio" class="gt_row gt_right">343.6</td>
<td headers="p.value" class="gt_row gt_right">&lt;0.001</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>Finally, we often want to obtain comparisons between particular estimated quantities. In this example we use the <code>emmeans</code> package again for this, this time using the <code>pairs()</code> function to produce comparisons between all pairs of species.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">penguin_pairs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> penguin_models <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowwise</span>(outcome) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb20-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reframe</span>(</span>
<span id="cb20-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">emmeans</span>(model, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"species"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb20-5">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pairs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">infer =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">adjust =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb20-6">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>()</span>
<span id="cb20-7">  )</span></code></pre></div>
</div>
<p>The first few rows of the data frame are shown below. The contents are similar to what we saw earlier for the estimated means, but this time each row contains information on a difference between pairs of means (described in the <code>contrast</code> column), along with the estimated difference in means, standard error, degrees of freedom, confidence interval, t-statistic and p-value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(penguin_pairs)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
  outcome       contrast estimate    SE    df lower.CL upper.CL t.ratio  p.value
  &lt;fct&gt;         &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1 Bill length … Chinstr…  10.0    0.432   339    9.19    10.9    23.2   4.23e-72
2 Bill length … Gentoo …   8.71   0.360   339    8.01     9.42   24.2   5.33e-76
3 Bill length … Gentoo …  -1.33   0.447   339   -2.21    -0.449  -2.97  3.18e- 3
4 Bill depth (… Chinstr…   0.0742 0.164   339   -0.248    0.396   0.453 6.50e- 1
5 Bill depth (… Gentoo …  -3.36   0.136   339   -3.63    -3.10  -24.7   7.93e-78
6 Bill depth (… Gentoo …  -3.44   0.169   339   -3.77    -3.11  -20.3   1.59e-60</code></pre>
</div>
</div>
<p>These comparisons can be plotted or presented in a table using code very similar to what we used for the estimated means. The plot below also includes a dotted line indicating zero difference, which can be used as a visual indicator for whether comparisons are statistically significant.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">penguin_pairs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb23-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> estimate, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> contrast, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmin =</span> lower.CL, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmax =</span> upper.CL)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dotted"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_errorbar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> rev) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(outcome), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_x"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb23-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Difference in means"</span>, </span>
<span id="cb23-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Contrast"</span>,</span>
<span id="cb23-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Error bars show 95% confidence interval for difference in mean."</span></span>
<span id="cb23-12">  )</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2023/06/dplyr-fitting-multiple-models-at-once/index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="1170"></p>
</div>
</div>



 ]]></description>
  <category>r</category>
  <category>statistical-models</category>
  <guid>https://cameronpatrick.com/post/2023/06/dplyr-fitting-multiple-models-at-once/index.html</guid>
  <pubDate>Wed, 07 Jun 2023 14:00:00 GMT</pubDate>
</item>
<item>
  <title>Making beautiful bar charts with ggplot</title>
  <dc:creator>Cameron Patrick</dc:creator>
  <link>https://cameronpatrick.com/post/2020/03/beautiful-bar-charts-ggplot/index.html</link>
  <description><![CDATA[ 




<p>Bar charts (or bar graphs) are commonly used, but they’re also a simple type of graph where the defaults in ggplot leave a lot to be desired. This is a step-by-step description of how I’d go about improving them, describing the thought processess along the way. Every plot is different and the decisions you make need to reflect the message you’re trying to convey, so don’t treat this post as a recipe, treat it as some points to consider—and hopefully, a few tips that will help you achieve the look you want in your own plots.</p>
<p>For this blog post, I’m going to use the number of seats won by each political party in the 2018 Victorian state election as an example. This data was obtained from <a href="https://www.vec.vic.gov.au/Results/State2018/Summary.html">the Victorian Electoral Commission</a>. Victorians may remember this election being described as a “Danslide”, where Labor, led by Premier Daniel Andrews, won a clear majority of seats.</p>
<p>Here’s the data as an R command you can paste if you want to try making these plots yourself:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">election_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tribble</span>(</span>
<span id="cb1-2">                    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>party, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>seats_won,</span>
<span id="cb1-3">       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Australian Greens"</span>,          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb1-4">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Australian Labor Party"</span>,         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">55</span>,</span>
<span id="cb1-5">                 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Liberal"</span>,         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,</span>
<span id="cb1-6">           <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The Nationals"</span>,          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,</span>
<span id="cb1-7">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Other Candidates"</span>,          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb1-8">)</span></code></pre></div>
</div>
<p>The first decision to make when you’re thinking of making a bar chart is whether you’d be better off using a different type of plot entirely. Bar charts are most suitable for displaying counts, percentages or other quantities where zero has a special meaning. If you make a bar chart, your axis should always start at zero, or the area of the bar gives a misleading visual impression. Other ways of representing data, such as box plots or points with error bars, may be more appropriate for quantities where zero is not an important reference point. If you are representing time series data (repeated observations made over time), a continuous line (perhaps with points at the the times where observations were made) is almost always better than a sequence of bars.</p>
<p>The second decision to make is which axis to put the categorical variable and which axis to put the numerical variable. Having the categories on the <em>y</em> axis often works best. It gives you more space when you have either a large number of categories or categories with long labels.</p>
<p>A lot of software either makes it more difficult to put categories on the <em>y</em> axis, or requires you to change a setting away from the default. This used to be the case for ggplot, but as of version 3.3.0, you just need to tell it which variable goes on which axis, and it will figure out the rest:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(election_data,</span>
<span id="cb2-2">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> seats_won, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> party)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2020/03/beautiful-bar-charts-ggplot/index_files/figure-html/barchart1-1.png" class="img-fluid" width="720"></p>
</div>
</div>
<p>The bar chart above is a good starting point, but quite a few things could be improved. The order of the categories is a bit odd: from top to bottom, it’s in reverse alphabetical order. This is the default in ggplot, but it is almost never what you want. The easiest way to change this is to give the option <code>limits = rev</code> to the <em>y</em> axis scale (this is also new in ggplot version 3.3.0):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(election_data,</span>
<span id="cb3-2">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> seats_won, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> party)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> rev)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2020/03/beautiful-bar-charts-ggplot/index_files/figure-html/barchart2-1.png" class="img-fluid" width="720"></p>
</div>
</div>
<p>In this particular case, alphabetical ordering isn’t the best choice. It’s often best to order categories from most common to least common, or from most to least in the variable you’re displaying (e.g.&nbsp;most to least seats won). There are two functions in the <code>forcats</code> package which can help with this: <code>fct_infreq</code> orders the level of a factor by how frequently they occur in the data, and <code>fct_reorder</code> orders the level of a factor by the values of a different variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">election_data_sorted <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> election_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">party =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_reorder</span>(party, seats_won, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.desc =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(election_data_sorted,</span>
<span id="cb5-2">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> seats_won, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> party)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> rev)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2020/03/beautiful-bar-charts-ggplot/index_files/figure-html/barchart3-1.png" class="img-fluid" width="720"></p>
</div>
</div>
<p>If I was doing exploratory data analysis, or making a quick plot to show a colleague, I might stop at this point. But there is still plenty of room for improvement. To start with, the axis labels are the variable names in our data frame, which is better than no labels at all, but are usually too brief or jargon-laden for a wider audience. A good plot can be interpreted clearly with as little supporting information as possible—remember that a reader’s eye will be drawn to a large, colourful figure and ignore the paragraphs of text you’ve written describing the full context.</p>
<p>I’ve also changed the origin of the <em>x</em> axis so the bars are hard against the axis. Putting a blank space to the left of zero on a bar chart is something I’ve only ever seen in ggplot. It’s caused by ggplot’s standard rule of adding 10% padding on either side of the biggest and smallest values plotted. You can turn it off by setting the <code>expand</code> option on the <em>x</em> axis scale.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(election_data_sorted,</span>
<span id="cb6-2">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> seats_won, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> party)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> rev) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of seats won"</span>,</span>
<span id="cb6-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Party"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2020/03/beautiful-bar-charts-ggplot/index_files/figure-html/barchart4-1.png" class="img-fluid" width="720"></p>
</div>
</div>
<p>The grey background with white gridlines is a very distinctive ggplot default. Sometimes it works well—it can reduce the visual noise of gridlines in complex plots—but in this case I would normally opt for a simpler. I often use <code>theme_bw</code> or <code>theme_minimal</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(election_data_sorted,</span>
<span id="cb7-2">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> seats_won, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> party)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> rev) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of seats won"</span>,</span>
<span id="cb7-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Party"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2020/03/beautiful-bar-charts-ggplot/index_files/figure-html/barchart5-1.png" class="img-fluid" width="720"></p>
</div>
</div>
<p>The gridlines on the <em>x</em> axis are useful guides to the eye, but for a categorical variable with only a few categories, the gridlines only introduce clutter. They can be removed using the <code>theme</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(election_data_sorted,</span>
<span id="cb8-2">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> seats_won, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> party)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> rev) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of seats won"</span>,</span>
<span id="cb8-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Party"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2020/03/beautiful-bar-charts-ggplot/index_files/figure-html/barchart6-1.png" class="img-fluid" width="720"></p>
</div>
</div>
<p>The default dark grey bars look a bit drab. You can choose a colour and give it as an option to <code>geom_col</code>. If you’re like me, you’ll probably try a couple of wrong things first: either passing the colour inside <code>aes()</code> (won’t work, because the colour will be interpreted as data to plot) or using <code>colour</code> instead of <code>fill</code> (which changes the border colour instead). You can either use a hexadecimal colour code (like in HTML), or one of <a href="http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf">a number of built-in colour names</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(election_data_sorted,</span>
<span id="cb9-2">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> seats_won, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> party)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkorchid"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> rev) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of seats won"</span>,</span>
<span id="cb9-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Party"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2020/03/beautiful-bar-charts-ggplot/index_files/figure-html/barchart7-1.png" class="img-fluid" width="720"></p>
</div>
</div>
<p>In this context, it would be conventional to colour the bars based on the party being represented. Here I’ve set <code>fill = party</code>, then given a manual scale for the fill based on party colours found on Wikipedia. I also disabled the legend, which isn’t necessary in this instance—the party names are already next to the bars. I’ve also added a title and a caption indicating the source of the data; these wouldn’t normally be included in an academic publication but are a very good idea for a plot which might be copied out of context.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(election_data_sorted,</span>
<span id="cb10-2">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> seats_won, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> party, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> party)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> rev) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Australian Labor Party"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Liberal"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The Nationals"</span>,</span>
<span id="cb10-7">                               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Australian Greens"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Other Candidates"</span>),</span>
<span id="cb10-8">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#DE3533"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0047AB"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#006644"</span>,</span>
<span id="cb10-9">                               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#10C25B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#808080"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of seats won"</span>,</span>
<span id="cb10-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Party"</span>,</span>
<span id="cb10-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Victorian election 2018 lower house results"</span>,</span>
<span id="cb10-13">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data source: Victorian Electoral Commission"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb10-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2020/03/beautiful-bar-charts-ggplot/index_files/figure-html/barchart8-1.png" class="img-fluid" width="720"></p>
</div>
</div>
<p>Depending on what you’re trying to show with the graph, you may want to add annotations beyond what is contained in the original data. For example, you could add a dashed line at 44 seats indicating the number required for a party to form a majority government (which could slightly misleading, since the Liberal and National parties govern in coalition). In ggplot, you can pass specific data to any <code>geom_</code> function; in this example I’m using <code>geom_vline</code> to draw the dashed line and <code>geom_text</code> to draw the label:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(election_data_sorted,</span>
<span id="cb11-2">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> seats_won, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> party, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> party)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey20"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"majority of</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">parliament"</span>, </span>
<span id="cb11-5">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> .pt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey20"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> rev) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Australian Labor Party"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Liberal"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The Nationals"</span>,</span>
<span id="cb11-10">                               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Australian Greens"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Other Candidates"</span>),</span>
<span id="cb11-11">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#DE3533"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0047AB"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#006644"</span>,</span>
<span id="cb11-12">                               <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#10C25B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#808080"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of seats won"</span>,</span>
<span id="cb11-14">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Party"</span>,</span>
<span id="cb11-15">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Victorian election 2018 lower house results"</span>,</span>
<span id="cb11-16">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data source: Victorian Electoral Commission"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb11-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb11-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2020/03/beautiful-bar-charts-ggplot/index_files/figure-html/barchart8b-1.png" class="img-fluid" width="720"></p>
</div>
</div>
<p>Finally, another good option for representing the same type of data as a bar chart is a line with a point at the end. The point draws the eye to the end of the line, which is the actual value being represented. You can create this in ggplot by using a <code>geom_segment</code> to draw the line segment and <code>geom_point</code> to draw the point. You also need to give <code>xend</code> and <code>yend</code> for <code>geom_segment</code> to work—it’s a general function for drawing line segments, not a specific functon for creating this type of plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(election_data_sorted,</span>
<span id="cb12-2">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> seats_won,</span>
<span id="cb12-3">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb12-4">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> party,</span>
<span id="cb12-5">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> party,</span>
<span id="cb12-6">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> party)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> rev) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Australian Labor Party"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Liberal"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The Nationals"</span>,</span>
<span id="cb12-12">                                 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Australian Greens"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Other Candidates"</span>),</span>
<span id="cb12-13">                      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#DE3533"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0047AB"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#006644"</span>,</span>
<span id="cb12-14">                                 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#10C25B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#808080"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of seats won"</span>,</span>
<span id="cb12-16">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Party"</span>,</span>
<span id="cb12-17">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Victorian election 2018 lower house results"</span>,</span>
<span id="cb12-18">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data source: Victorian Electoral Commission"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2020/03/beautiful-bar-charts-ggplot/index_files/figure-html/barchart9-1.png" class="img-fluid" width="720"></p>
</div>
</div>



 ]]></description>
  <category>r</category>
  <category>ggplot2</category>
  <guid>https://cameronpatrick.com/post/2020/03/beautiful-bar-charts-ggplot/index.html</guid>
  <pubDate>Sat, 14 Mar 2020 13:00:00 GMT</pubDate>
</item>
<item>
  <title>Things which are equivalent to t-tests</title>
  <dc:creator>Cameron Patrick</dc:creator>
  <link>https://cameronpatrick.com/post/2019/12/equivalent-to-t-test/index.html</link>
  <description><![CDATA[ 




<p>If you have a continuous measurement and two groups you’d like to compare based on that measurement, what’s the first statistical test that comes to mind? Chances are it’s the two-sample t-test, sometimes known as <em>Student’s t-test</em>. It’s typically the first statistical test taught in an introductory statistics course, it’s well known and understood, and it has good theoretical properties—so if a t-test answers your research question, you should probably use it. (Actually, in practice, you should probably use <em>Welch’s t-test</em> which doesn’t assume equal variance within groups. For the rest of the post, I’m only going to consider the equal variance case.)</p>
<p>Every now and again, I find a client in this situation who has done something which is… not a t-test. Here are some other ways to do the same thing which turn out to be identical to the two-sample t-test:</p>
<ul>
<li><p>One-way ANOVA: since ANOVA is often taught immediately after the t-test as “what do I do if I have more than two groups”, it should perhaps be no surprise that ANOVA gives identical p-values and confidence intervals to the t-test when you are only comparing two groups. This applies to both the overall F-test and the “post-hoc” pairwise t-test, which produce identical p-values in the two group scenario.</p></li>
<li><p>Linear regression with an indicator variable: by this I mean an explanatory variable which takes one numerical value for the first group and a different numerical value for the second group. For example, 0 for the first group and 1 for the second group. This also turns out to be equivalent to a t-test. If you’ve seen how ANOVA is implemented by most software as a linear model with indicator variables for categories, this might not surprise you either.</p></li>
<li><p>Linear regression with the indicator variable as the outcome and the measurement as the explanatory variable: as backwards as this may sound, this will also produce exactly the same p-value as a t-test. The hypothesis test for linear regression slope is the same regardless of which variable is the outcome and which is the predictor, although the regression equation is usually different.</p></li>
<li><p>Correlation with an indicator variable: this is also equivalent to a t-test. This follows from the above two because the hypothesis test for correlation being equal to zero is equivalent to the hypothesis test for linear regression slope being equal to zero.</p></li>
<li><p>Logistic regression with the group variable as the outcome and the continuous variable as a predictor: this is <em>not quite</em> the same as a t-test. However, if the measurements of the two groups are normally distributed, then the t-test and logistic regression are asymptotically equivalent—meaning that for a sufficiently large sample size, they will give the same p-values. The two methods also answer different research questions: the t-test is for a difference in means between two groups while logistic regression estimates the odds ratio of having a positive outcome (being in a particular group) for a given increase in the continuous predictor. The choice between the two methods should be based on which variable is your outcome and which variable is your explanatory variable; or whether you would prefer to discuss an odds ratio or a difference in means.</p></li>
<li><p>Pairwise comparisons from an ANOVA model with more than two groups are also not quite equivalent to a t-test. What’s the difference? Both use a test statistic that has a <em>t</em> distribution calculated from the same difference in means, but the ANOVA pairwise comparisons will have better power because they use a pooled standard deviation from all groups (which, if the assumption of equal standard deviation in every group is true, will be more a precise estimate) and a <em>t</em> distribution with more degrees of freedom (which can make a big difference with a small sample size). As the sample size increases, the advantage of ANOVA over individual t-tests diminishes.</p></li>
<li><p><strong>Bonus:</strong> The Mann-Whitney test (or Wilcoxon rank sum test) is equivalent to proportional odds logistic regression. (This claim is made in Frank Harrell’s <em>Regression Modeling Strategies</em> text; unlike the other examples above, I haven’t proved or read a proof of this equivalence.)</p></li>
</ul>



 ]]></description>
  <category>statistics</category>
  <category>t-test</category>
  <guid>https://cameronpatrick.com/post/2019/12/equivalent-to-t-test/index.html</guid>
  <pubDate>Sun, 15 Dec 2019 13:00:00 GMT</pubDate>
</item>
<item>
  <title>Understanding levels of variation and mixed models</title>
  <dc:creator>Cameron Patrick</dc:creator>
  <link>https://cameronpatrick.com/post/2019/12/understanding-levels-variation/index.html</link>
  <description><![CDATA[ 




<p>Data that has some kind of hierarchical structure to it is very common in many fields, but is rarely discussed in introductory statistics courses. Terms used to describe this kind of data include hierarchical data, multi-level data, longitudinal data, split-plot designs or repeated measures designs. Statistical models used for these types of data include mixed-effects models (often abbreviated to just <em>mixed models</em>), repeated measures ANOVA and generalised estimating equations (GEEs).</p>
<p>All of these terms and models arose from different contexts, but they share a common feature. Observations are not independent, as many classical statistical methods assume, and there is structure to the dependence which can be incorporated into a statistical model.</p>
<p><strong>Using a statistical model which doesn’t account for the hierarchical nature of this data will give incorrect results.</strong></p>
<section id="common-examples-of-hierarchical-data" class="level2">
<h2 class="anchored" data-anchor-id="common-examples-of-hierarchical-data">Common examples of hierarchical data</h2>
<p>Data with two levels of variation often arise when multiple measurements are made on the same units of observation. In the case of designed experiments, treatments may also be assigned to different levels of the hierarchy. Factors are commonly described as <em>within</em>-subject (varying at the lowest level) or <em>between</em>-subject (varying at a higher level). Some examples:</p>
<ul>
<li>Measurements made on the same people at several points in time. This is often called longitudinal data. In this example, time would be a within-subject factor and most other variables of interest—e.g., treatment, age or gender—would be between-subject.</li>
<li>Measurements made at different depths of a number of rock core samples. In this example, the depths would be a within-subject factor and the location where the sample was obtained would be a between-subject factor.</li>
<li>Assigning different treatments to different legs, arms or eyes of a number of people. For example, one eye may be given a new drug and the other eye a placebo. In this example, treatment is a within-subject factor.</li>
<li>A split-plot experiment in agriculture: splitting plots of land into sections, planting different crops in each section, and using different irrigation methods on different plots. In this example, variety is a within-plot factor and irrigation is a between-plot factor.</li>
<li>A split-mouth design in dentistry: assigning different treatments to different parts of participants’ mouths.</li>
</ul>
<p>It is possible to have more than two levels of variation. Some examples from different fields of research:</p>
<ul>
<li>Students within classrooms within schools.</li>
<li>Repeated surveys administered to individuals within organisations.</li>
<li>Glands within lesions within patients.</li>
<li>Blocks of land divided into plots divided into subplots.</li>
</ul>
<p>In situations with multiple levels, it is common to describe variables based on the level at which they are measured or assigned, e.g.&nbsp;student-level, classroom-level or school-level.</p>
</section>
<section id="random-effects" class="level2">
<h2 class="anchored" data-anchor-id="random-effects">Random effects</h2>
<p>Multi-level data is commonly modelled using <em>mixed-effects models</em>, which get their name because they have both fixed effects and random effects. Fixed effects are the kind of explanatory variables you may be used to in ANOVA or linear regression: you would like to directly estimate the effect of these variables on your outcome. For example: treatment (drug or placebo) and time; crop variety and irrigation; depth and location of rock core samples. In these examples, the random effects would be the variables which group together correlated observations: participants in a trial; plots of land; rock core samples.</p>
<p>Here are two different ways to think about random effects:</p>
<ol type="1">
<li>Random effects are factors where the individual levels are random samples from a larger population, or can be thought of in this way.</li>
<li>Random effects are factors where you don’t care about the actual effect they have on your outcome, just their ability to account for correlation between observations.</li>
</ol>
<p>For a random effect, instead of estimating the effect of each specific level of the factor (e.g.&nbsp;each individual in a study), the model estimates the variance explained by that factor. This is sometimes reported as the proportion of variation explained at each level, e.g.&nbsp;63% of variance was at the individual level.</p>
<p>Random effects can be “nested” inside other random effects if there are more than two levels of variation. For example, “classroom within school” could be specified as a random effect.</p>
</section>
<section id="simpler-analysis-options" class="level2">
<h2 class="anchored" data-anchor-id="simpler-analysis-options">Simpler analysis options</h2>
<p>It is sometimes possible to simplify an analysis if there are no variables which distinguish individuals at a particular level. For example, consider an experiment in which treatments were randomly assigned to litters of pigs but measurements were made on individual pigs, with no pig-level variables (e.g.&nbsp;sex) of interest in the analysis. In this situation, analysing litter averages would be a simpler analysis providing the same results as the mixed model.</p>
<p>Another common situation is when there is a single within-subjects factor with two levels, for example before and after measurements. This kind of design can be analysed with a paired t-test or Wilcoxon signed rank test.</p>
<p>As a practical consideration, random effects work best when they have a reasonable number of different levels. It may be better to treat a factor which is conceptually random as a fixed effect instead in some cases; e.g.&nbsp;if you are studying students from two or three schools, school should probably be a fixed effect rather than a random effect. There are also situations where this approach is not appropriate.</p>
<p>If in doubt about how to analyse your multi-level data, <a href="https://scc.ms.unimelb.edu.au/">consult a statistician</a>.</p>
</section>
<section id="study-design-considerations" class="level2">
<h2 class="anchored" data-anchor-id="study-design-considerations">Study design considerations</h2>
<p>Effects at the lowest level of the hierarchy (e.g.&nbsp;within-subject) are usually estimated more precisely than effects at higher levels (e.g.&nbsp;between-subject). Or equivalently, tests of within-subject effects tend to be more powerful than tests of between-subject effects. One intuition about this is that there are more observations at the lowest level (e.g.&nbsp;number of subplots) than there are at higher levels (e.g.&nbsp;number of plots). Another way to look at this is that for within-subject factors, each individual unit of observation is effectively their own control.</p>


</section>

 ]]></description>
  <category>statistics</category>
  <category>mixed-models</category>
  <guid>https://cameronpatrick.com/post/2019/12/understanding-levels-variation/index.html</guid>
  <pubDate>Mon, 09 Dec 2019 13:00:00 GMT</pubDate>
</item>
<item>
  <title>Plotting multiple variables at once using ggplot2 and tidyr</title>
  <dc:creator>Cameron Patrick</dc:creator>
  <link>https://cameronpatrick.com/post/2019/11/plotting-multiple-variables-ggplot2-tidyr/index.html</link>
  <description><![CDATA[ 




<p>In exploratory data analysis, it’s common to want to make similar plots of a number of variables at once. For example, a randomised trial may look at several outcomes, or a survey may have a large number of questions. Here is a way to achieve to plot them efficiently using R and <code>ggplot2</code>.</p>
<section id="pivoting-longer-turning-your-variables-into-rows" class="level2">
<h2 class="anchored" data-anchor-id="pivoting-longer-turning-your-variables-into-rows">Pivoting longer: turning your variables into rows</h2>
<p><code>ggplot2</code> doesn’t provide an easy facility to plot multiple variables at once because this is usually a sign that <a href="https://r4ds.had.co.nz/tidy-data.html">your data is not “tidy”</a>. For example, in situations where you want to plot two columns on a graph as points with different colours, the two columns often really represent the same variable, and there is a hidden grouping factor which distinguishes the data points you want to colour differently. The usual answer in this scenario is that you should restructure your data before plotting it. As a bonus, it will probably be easier to analyse your data in that form too.</p>
<p>Likewise, if you want to split a plot into panels (or facets, in <code>ggplot2</code>-speak), you must plot a single response variable, with a grouping variable to indicate which panel the data should be plotted in. The best structure for your data depends on what you’re trying to do with it, and in this situation, even if your data is in the right form for analysis, it may not be right for some of the plots you want to make.</p>
<p>Fortunately, restructuring your data into the right form is straightforward using the <code>tidyr</code> package and the <code>pivot_longer()</code> function. In this example, I’m going to look at some mocked-up survey data, with six questions stored in variables <code>Q1</code> through <code>Q6</code>. The original data frame looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(survey_data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 300 × 7
   group    Q1    Q2    Q3    Q4    Q5    Q6
   &lt;fct&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1 B         4     1     4     1     2     3
 2 B         5     2     5     4     3     3
 3 B         5     4     4     2     2     3
 4 B         5     1     5     2     4     3
 5 A         5     2     5     1     1     2
 6 A         5     3     5     3     2     2
 7 A         4     3     5     1     4     1
 8 B         4     3     5     1     2     1
 9 B         4     4     4     1     3     2
10 B         4     4     5     2     5     4
# ℹ 290 more rows</code></pre>
</div>
</div>
<p>You can convert this into a longer data frame where the question number is stored in one column and the response is stored in a separate column:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">longer_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> survey_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(Q1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>Q6, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"response"</span>)</span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(longer_data)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,800 × 3
   group question response
   &lt;fct&gt; &lt;chr&gt;       &lt;int&gt;
 1 B     Q1              4
 2 B     Q2              1
 3 B     Q3              4
 4 B     Q4              1
 5 B     Q5              2
 6 B     Q6              3
 7 B     Q1              5
 8 B     Q2              2
 9 B     Q3              5
10 B     Q4              4
# ℹ 1,790 more rows</code></pre>
</div>
</div>
<p>You don’t even need to store the ‘long form’ data as a separate variable. If you’re not going to use the data in this form for anything else, it’s simpler to pipe the data straight into <code>ggplot2</code>. Here I use the <code>facet_wrap()</code> function to plot each question in a separate panel, so we can see the distribution of all of the questions at once:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">survey_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(Q1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>Q6, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"response"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> response)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(question), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Response (on a 1 to 5 scale)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of respondents"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2019/11/plotting-multiple-variables-ggplot2-tidyr/index_files/figure-html/panel-plot-1.png" class="img-fluid" width="720"></p>
</div>
</div>
<p>You can use <code>question</code> as a factor anywhere else you would use a categorical variable with ggplot. For example, you can make some box plots:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">survey_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(Q1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>Q6, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"response"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> response, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> question)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_boxplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Question"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Response (on a 1 to 5 scale)"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2019/11/plotting-multiple-variables-ggplot2-tidyr/index_files/figure-html/box-plot-1.png" class="img-fluid" width="720"></p>
</div>
</div>
<p>This is also a nice demonstration of how box plots are rarely the best way to present Likert scale data.</p>
<p>Any other variables are retained after you call <code>pivot_longer()</code>, so you can e.g.&nbsp;compare the responses to survey questions based on a demographic variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">survey_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(Q1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>Q6, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"response"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> response, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> group)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(question), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Response (on a 1 to 5 scale)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of respondents"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://cameronpatrick.com/post/2019/11/plotting-multiple-variables-ggplot2-tidyr/index_files/figure-html/line-plot-1.png" class="img-fluid" width="720"></p>
</div>
</div>
<p>By default, R will sort the levels of factors alphabetically. This isn’t always what you want in this situation—often the order of the variables in your data frame has some meaning to it. The <code>fct_inorder()</code> function allows you to reorder levels of a factor in the order of first appearance in the file. If you use that with the column produced by <code>pivot_longer()</code>, the factor will be ordered by the order of the columns in the original data frame.</p>


</section>

 ]]></description>
  <category>r</category>
  <category>ggplot</category>
  <guid>https://cameronpatrick.com/post/2019/11/plotting-multiple-variables-ggplot2-tidyr/index.html</guid>
  <pubDate>Mon, 25 Nov 2019 13:00:00 GMT</pubDate>
</item>
</channel>
</rss>
